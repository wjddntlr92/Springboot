<html layout:decorate="~{layout}">

<div layout:fragment="content" class="col-lg-12" id="content">
	<div class="container">
	
		<div style="margin-bottom:40px;">
    		<h2 class="my-3 border-bottom pb-2">Item List</h2>
		</div>
  		<div class="row row-cols-3">
    		<div class="col" th:each="item, loop :${paging}">
    			<div class="card" style="width: 24rem; margin:20px;">
    				<div th:each="itemImg, loop : ${item.itemImgs}">
    					<img th:src="@{|/images/${itemImg.itemImgUploadName}|}" th:if=" ${loop.index} == 0 " style="width: 200; height:300px"  class="card-img-top" alt="...">
    				</div>
    				
  					<div class="card-body" >
    					<h5 class="card-title" th:text="${item.itemName}"></h5>
  						<div style="margin-top: 20px;"  th:text="|${item.price} 원|">  												
  						</div>
    					<a th:href="@{|/item/detail/${item.id}|}" class="btn btn-light" style="margin-top: 20px;">show detail</a>
  					</div> 					
				</div>			
			</div>
							
  		</div>
	
		<div class="row">
	
			<div class="col-6">
        		<div style="margin: 40px;">
            		<a th:href="@{/item/upload}"  class="btn btn-success">UpLoad</a>
        		</div>	
        	</div>
        
        	<div class="col-6">
            	<div class="input-group" style="margin: 40px;">
                	<input type="text" id="search_kw" class="form-control" th:value="${kw}">
                	<div class="input-group-append">
                    	<button class="btn btn-outline-success" type="button" id="btn_search">Search</button>
                	</div>
            	</div>
        	</div>        
		</div>
		
		<div th:if="${!paging.isEmpty()}">
        	<ul class="pagination justify-content-center">
            	<li class="page-item" th:classappend="${!paging.hasPrevious} ? 'disabled'">
                	<a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}">
                    	<span><<</span>
                	</a>
            	</li>
            	<li th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
                th:classappend="${page == paging.number} ? 'active'" 
                class="page-item"
                th:if="${page >= paging.number-5 and page <= paging.number+5}">
                	<a th:text="${page}" class="page-link" href="javascript:void(0)" style="link-color:white;" th:data-page="${page}"></a>
            	</li>
            	<li class="page-item" th:classappend="${!paging.hasNext} ? 'disabled'">
                	<a class="page-link" href="javascript:void(0)" th:data-page="${paging.number+1}">
                    	<span>>></span>
                	</a>
            	</li>
        	</ul>
    	</div>
    
    <!-- 페이징처리 끝 -->
    <form th:action="@{/item/list}" method="get" id="searchForm">
        <input type="hidden" id="kw" name="kw" th:value="${kw}">
        <input type="hidden" id="page" name="page" th:value="${paging.number}">
    </form>
    
	</div>
</div>
<script layout:fragment="script" type='text/javascript'>
	const page_elements = document.getElementsByClassName("page-link");
	Array.from(page_elements).forEach(function(element) {
    	element.addEventListener('click', function() {
        	document.getElementById('page').value = this.dataset.page;
        	document.getElementById('searchForm').submit();
    	});
	});
	const btn_search = document.getElementById("btn_search");
	btn_search.addEventListener('click', function() {
    	document.getElementById('kw').value = document.getElementById('search_kw').value;
   		document.getElementById('page').value = 0;  // 검색버튼을 클릭할 경우 0페이지부터 조회한다.
   		document.getElementById('searchForm').submit();
	});
</script>
 
		   
  

</html>